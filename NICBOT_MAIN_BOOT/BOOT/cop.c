/**************************************************************************
PROJECT:     CANopen Bootloader for Atmel AT90CAN128 AVR Microcontroller
MODULE:      COP.C
CONTAINS:    COP watchdog functions for the AT90CAN128 microcontroller
ENVIRONMENT: Compiled and tested with IAR EW for AVR on
             Atmel STK500/501 with AT90CAN128
             Compiler Version 5.11b
COPYRIGHT:   This version Embedded Systems Academy, Inc.
             Developed by Embedded Systems Academy, Inc.
VERSION:     $LastChangedDate: 2013-05-28 02:11:48 +0200 (Tue, 28 May 2013) $
             $LastChangedRevision: 2624 $
***************************************************************************/


#include "types.h"
#include "mcu.h"
#include "cop.h"


/**************************************************************************
 LOCAL DEFINITIONS
***************************************************************************/


/**************************************************************************
 EXTERNAL REFERENCES
***************************************************************************/


/**************************************************************************
 PUBLIC DEFINITIONS
***************************************************************************/


/**************************************************************************
 LOCAL FUNCTION PROTOTYPES
***************************************************************************/


/**************************************************************************
 LOCAL FUNCTIONS
***************************************************************************/


/**************************************************************************
 PUBLIC FUNCTIONS
***************************************************************************/

/**************************************************************************
DOES:    Serve the watchdog
RETURNS: -
***************************************************************************/
void COP_Serve (
  void
  )
{
  asm( "WDR" ); // Watchdog reset
}


/**************************************************************************
DOES:    Force a COP reset upon command
RETURNS: -
**************************************************************************/
void COP_Force_Reset (
  void
  )
{
  WDTCR = (1<<WDCE)|(1<<WDE);  // Shortest period to timeout, Watchdog enabled

  for ( ;; )   // Wait until watchdog period expires => Reset
  { // do nothing
    ;
  }
}

/**************************************************************************
END OF FILE
***************************************************************************/

